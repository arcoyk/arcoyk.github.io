Graph Based Paring Algorithm Applied to Novel Recipe Creation

ABSTRACT
レシピデータにレシピ創造のパタンを入力する事で，いままでになく，美味しいレシピを自動生成するアルゴリズムを紹介する．このアルゴリズムはレシピを構成する食材同士がまんべんなく緩くつながっているレシピを見つける．レシピ創造の新しい流れに触れた後で，アルゴリズムを紹介し，直近の課題を示した後，代替味覚やレシピ生成以外への応用などの可能性を示す．このプロジェクトの目的は独立して動くAIではなく，人間の創造力をコンピュータの記憶力や処理能力でエンハンスするシステムの構築である．このプロジェクトはまだ公開していないので，この文章はクローズドであり，研究のためのファンドが見つかり次第公開する．また，アルゴリズムに関してパテント習得に意欲的である．

This paper proposes an algorithm that generates novel and tasty recipes. The algorithm searches sets of ingredients that weekly and evenly matches each other. Firstly, I will describe the background and motivation of this work. Secondly, I will describe the algorithm and facing problems. Finally, I will describe potential possibilities such as representative gustations and broad application of the algorithm. The goal of this project is not to create an independent artificial intelligence, but to provide a system that enhances human creativity by machine memory or processing power.

BACKGROUND
Novel Cuisine
El Bulliに代表される先進的なレストランがフランス料理を進化させている．彼らは可食な素材をリストアップし，あらゆる組み合わせを考えるためのラボを創立した．新しいレシピはこのリストの中の材料の新しい組み合わせから生まれる．
しかし例えすべての食材をリストアップできても，すべての組み合わせを確かめて，ベストなレシピを決定するのは難しい．その理由の一つとして，風味を確かめる確実な方法は実際に食べてみることである事がある．そのため新しいレシピを作る時は頭の中で味を想像するしかない．しかし，ここで二つ目の問題として，人間が複数個の材料の味を想像する事が困難である事が挙げられる．このプロジェクトのモチベーションは，レシピを作る際の食材の組み合わせのパターンを，コンピュータでレシピ総当たり的に適応することで，人間の創造性をコンピュータの記憶力で後押しする事である．

Innovative restaurants represented by el Bulli is cutting edge of cuisine. Most successful molecular gastronomy restaurant el Bulli closed restaurant and founded a lab to explore possible recipes using one set of lists of edible materials. New recipes will be composed within these lists. However the list is long enough to cover all ingredients, exploring every combinations is difficult. One of the reasons is that the most reliable way to confirm its gustation is to bring ingredients together and actually eat them. Another reason is that imaging gustaiton of several ingredients at a time is difficult because of the limited human memory. The motivation of this project is to enhance human creativity by supporting it with machine memory and processing power using database of recipes and patterns that chefs use when creating new recipes.

PARING NETWORK ALGORITHM
コンピュータをもちいてレシピの評価を行うために，食材の相性を定量化する．既存のレシピは，莫大な数の食材の組み合わせから，歴史的に選び取られた結果であるため，二つの食材間にあるレシピの数をカウントする事で食材の相性を定量化できる．たとえば，同じレシピに含まれる食材は相性が良いと考えられる．さらに，good paring A-B and good paring B-C means (weak but) good paring A-Cと仮定する．食材をノード，食材がレシピを共有しているか否かをリンクとして，食材同士の相性をネットワークとして描画すると図１のようになる．

From here I will describe the system. First of all, I quantified compatibility of two ingredients so that computer can evaluate a recipe without bringing them together. The basis of my theory is the fact that inherited recipes are the selection of huge amount of recipe experiments in the cuisine history, and thus they are relatively tasty in the possible combination of ingredients. According to this assumption, we can quantify compatibility of two ingredients by explore how ingredients share recipes. Firstly, we supposed that ingredients are compatible each other if they share a recipe. Secondly, compatibility of ingredient A and B, and compatibility of ingredient B and C would suggest compatibility of ingredient A and C, although the compatibility might be weak compared with compatibility of ingredients in one recipe. Finally, compatibilities of ingredients can be described as a network graph as shown in Figure1 where a node represents an ingredient, and a link represents a compatibility of two ingredients.
（図１）

Figure1
Ingredient network of three recipes: a recipe including ingredient A, B and C, and a recipe including B, D, E and F, and a recipe including G and H. Each node represents each ingredient, and each link represents compatibility between two ingredients. There are three perfect network in which all nodes are linked each other, because of the assumption that ingredients that share a recipe are compatible each other.

図１は，A-B-Cを持つレシピとB-D-Eを持つレシピを入力した結果である．
この手法をAllrecipesの一部のレシピに適応したグラフが図２である．
You will get Figure2 by applying this method to several recipes in All Recipes (http://allrecipes.com).


Figure2
Ingredient network of several recipes in All Recipes (http://allrecipes.com). Recipes are shown as perfect networks (a), because of the assumption that ingredients that share a recipe are compatible each other. Famous ingredients such as salt or pepper are shared by several recipes (b). The system generates new recipe by randomly selecting ingredients and value it by analyzing the network between the ingredients.

Creativity vs Stability
このネットワークを使ってレシピ創造に関する問題を解決できる．例えば，レシピの創造に取り組む際に，クリエイティビティが上がるにつれてレシピの味が不安定になる問題がある．創作料理や前衛的料理などの創造力を使った新しいレシピは，従来のバランスのとれたレシピに比べて，失敗する可能性が高い．

Using this ingredient network, we can solve problems we face when creating new recipes. For example, the harmony of flavor of a new recipe tend to be instable as we try to make the recipe more creative, wild or strange. In other words, avant-garde recipes or original dishes often fails compared with traditional guaranteed recipes.

しかし，経験則により相性の食材の組み合わせのパタンを見いだす事ができる．例えば，従来のレシピに無いような組み合わせ（例：牡蠣とみかん）は味のまとまりがなくなるが，それぞれが含まれるレシピで両者をつなぎ合わせる事ができる．牡蠣はリゾットで生クリームと同じレシピを共有している．オレンジはオレンジケーキで生クリームとレシピを共有している．したがって，牡蠣とオレンジをそのままあわせるより，生クリームを加える事で味が安定すると考えられる．

However, we can empirically figure out patterns of ingredient compatibility. For example, avant-garde food paring, oyster and orange, seem not goes well, but recipes between two ingredients might be a hint to combine them together: oyster shares recipe "risotto" with fresh cream, and also orange shares recipe "orange cake" with fresh cream. These two recipes suggest that adding fresh cream to oyster and orange would be better (stable), rather than simply eat oyster and orange together.

このパタンをネットワークに当てはめると以下のようになる．ノード群のノードの数が食材の数，リンクの数がレシピの安定性を意味する．例えば，ノード群が完全ネットワーク（食材の相性が良い）であると安定性は上がるが，既存のレシピであるか，それにちかいためクリエイティビティはない．一方で，ノード間にリンクが無い（食材の相性が悪い）とクリエイティビティは上がるが，レシピは安定しない（美味しくない）．また，ノードあたりのリンク数にばらつきがある場合もレシピは安定しない．したがって，ノード当たりのリンク数が大きく，分散が小さいノード群がクリエイティビティがありかつ安定した味を持ったレシピと考えられる．この方法を総当たり的にテストする事で材料ネットワークから安定的でかつクリエイティブなレシピを抜き出す．

This pattern can be applied to the ingredient network as described below. Firstly, we will get a candidate of a new recipe by randomly selecting the set of nodes. In the set of nodes, the amount of nodes is the amount of ingredients, and the amount of links is the stability of its tastiness. For example, if the nodes create perfect network, the stability is maximum, but the creativity is minimum because it should be an existing recipe. On the contrary, if there is no link between nodes the creativity is high but the stability is low because existing recipes proved that the set of ingredients does not goes well. Biased link (some nodes are strongly linked and others are not) also means less stability. Thus, a set of nodes are creative and stable when the amount of links per node is high, and the distribution of links per nodes is low.


RESULT
出力結果の例を示す．これらの出力はgitで公開されているプログラムで再現可能である．プログラムの実行にはProcessing.orgのProcessingをインストールする必要がある．

レシピ郡：
ーー

生成されたレシピ：
ーー

Discussion

食事全体への応用：
このアルゴリズムは一つの食事での食べ合わせを評価することも可能である．例えば，写真の食事はフルーツ，ご飯，ヨーグルト，パンで構成されているが，この食事に対してオレンジジュースがあうか，牛乳があうか計算する事ができる．フルーツと牛乳はシリアルやシェークでレシピを共有している．同じように，ヨーグルトはラッシーやムース，パンはフレンチトースト，ご飯はリゾットで牛乳とレシピを共有しているため，この食事に牛乳を加えても味が安定する事がわかる．しかし，オレンジジュースとご飯は共有しているレシピが見つからないため，安定性をくずす．したがって，アルゴリズムによるとこの食事には牛乳を選ぶべきである．
（機内食とオレンジジュースとミルク）

Application to Meal:
This system also can be applied to a meal (a set of dishes) and value its harmony. For example, Figure3 shows a meal that contains fruits, rice, yogurt and bread. The system can decide which of milk or orange juice goes well with the meal as below. Fruits and milk shares recipes such as serial or shake. Similarly, yogurt shares recipe serial or Lassi, bread shares recipe French toast, rice shares recipe risotto. Thus, it turns out that milk doesn't affect to the stability of the meal. On the contrary, orange juice and rice don't share a recipe and result in a less compatibility. Thus, milk is better with this meal than orange juice, according to the system.

リソースの最適化：
一度の食事で材料を使い切る事はまれであり，材料が余る．しかし，この材料を違うレシピに使おうとするとさらに食材を購入する必要があり，また余剰が生じる．残り物を整理できて，かつ美味しく，さらに残り物がでないレシピを見つけるのは難しい．したがって，残りものの整理のために家庭では不本意な創作料理が行われる．このアルゴリズムを使うと最小限で美味しいレシピを構成できるため，余剰を減らす事ができる．例えば，複数の料理を作ってバラバラなざいりょうが余った場合でも，それぞれの材料をに安定性を与えるような食材を最小限で選ぶ事で食材を整理できる．

Organizing Leftovers:
Using up ingredients in a meal is rare in cooking, and there often will be leftovers. To consume these leftovers, we have to get extra ingredients for another recipes, and get leftovers again. It is hard to find recipes that are tasty, consume these leftovers and doesn't result in another leftovers. For this reason, we unwillingly compose leftovers and make original recipes. The system is also useful to organize these leftovers because it can find tasty recipes that includes all leftovers with minimum extra ingredients.

Future Work
表記揺れの解消：
このプロジェクトの最大の技術的課題は材料の表記揺れを解消することである．レシピの中には同じような材料を持ちながらも，レシピを書いた人によって表記が異なる場合がある．例えば，加工された材料（ex.chopped chicken brest)や商品名（ex.hershy's chocolate sauce)などが含まれる．こうした表記揺れはデータベースの材料の種類の増大につながり，疎で肥大化したデータベースの原因となる．したがって，表記揺れを解消する自然言語処理を実装する必要がある．一方で，加工された食材を加工前の食材と同一に扱うのか否かについても議論の余地がある．特にハーシーチョコレート程度の混成による加工食品はチョコレートとして分類できると考えられるが，アンチョビのような発酵食品やマヨネーズのような乳化作用などの化け学的変化をともなう加工の場合，どの食材にも分類できない食材として扱うべきだと考えられる．食材のカテゴリー分けがどの程度の科学的変化で行われるべきなのか精査する必要がある．

Orthographical Variant Detection:
The biggest technological problem of this project is orthographical variant detection. There are many ingredients written in different words with same meanings such as processed food (ex. chopped chicken breast) or product names (ex. Hershey's chocolate). These orthographical variants increases data, and results in vast and huge database. For this reason, we need to implement orthographical variant detection. In addition, there is room for discussion as to weather we treat processed food and pure food as same or not. Especially, mixed food such as Hershey's chocolate could be categorized as chocolate, but in case of anchovy which include fermentation, or mayonnaise which contains emulsification in the cooking process should be categorized as is, although this may varies case by case. So, we need to discuss the criteria about how to define "ingredient" in terms of chemical components, considering functional impacts over the ingredient network and algorithm.

味覚科学の探索：
このネットワークは美味しさを客観的な指標として扱っているが，人によって美味しさの評価にはばらつきがある．美味しさの定義は科学的にも定まっておらず，分析が進んでいない．したがって，アルゴリズムを評価するためには国籍，嗜好，性別の違う被験者に試食させて評価の分布を見る必要がある．

Exploring the Science of Gustation:
The system suppose tastiness as an objective value, but tastiness differs by people. Also, there is no scientific definition of tastiness. Thus, to evaluate this system, we need to conduct a user study and survey the variance of evaluations of people with different nationalities, likings or sex.

創造性への影響：
このアルゴリズムはある程度レシピの創造に貢献すると考えられるが，シェフは調理法やプロフェッショナルの創造力によってレシピを創造するため，さらに良いアルゴリズムのためにはシェフの意見を聴く必要がある．その次の段階として，シェフのレシピ創造のパタンを，コンピュータの力ですべての食材に試し，その結果をフィードバックした際にシェフの創造性をどう刺激するのか興味深い．それは，外部からの情報がクリエータの創造力を刺激することはよくあるからである．この点は，プロでない創作料理についても同じであり，コンピュータエンハンスされたレシピ作成環境が創造力にどのような影響を与えるのかテストする必要がある．この段階では材料のサジェスト方法などのインタラクション手法による影響力の違いや，シェフの創造力とコンピュータの探索能力をいかに統合するかが焦点となる．

Impact on Creativity:
This system focus on ingredients of recipes. However, chefs may consider other factors such as cooking method or exploring new ingredients. So, we need consult professional chefs to refine the supposed process of new recipe creation. It is also interesting how the output of the system impact to chefs' creativity when applied an creation patterns of the chef, and feedback the result of all possibilities of recipes, that is not possible with human hand: it is common that input from outside stimulates creation. Thus, we need to conduct a user study not only with the professionals, but also with amateur cook at home. At this stage, where broader issues that how computer power impact to human creation are being focused on, we need to consider Human Computer Interaction (HCI) perspective which includes experiments of various functions and User Interface (UI) to explore techniques to integrate machine power to human creativity.

FUTURE VISION
ファットフリーフレンチ：代替味覚の挑戦
食べ物の組み合わせによっては，同時に食べると他の食材の味になる場合がある．例えば，醤油とプリンを一緒に食べるとうにの味になることが知られている．こうした食べ合わせはいたずらのような試みから発見されて来た．この現象は食材の値段，栄養価，入手しやすさなどの不利な点を他の食材の組み合わせで補える可能性を秘めている．現在のアルゴリズムではまだ不可能であるが，例えばターゲットする食材が含まれているレシピを探索する事で代替味覚が可能かもしれない．これが可能になれば安価でファットフリーなフレンチが実現できる．

Fat-Free French - representative gusutation:
Same food parings turn out to the taste of another existing food. For example, eating soy-sauce and pudding at a time turns out to the taste of sea urchin. These food parings have been discovered in the process of adventuresome or tricky challenges of eating food. Although there should be a complex chemical system behind it, this suggests a big challenge of representative gustations: a food paring technique which enables chefs to create the taste of target ingredient without the ingredient, but with several other ingredients. Representative gustations could be a way of recipe creation where we are free from limitations on ingredients selection such as geographic or economical availability, and chemical issues such as fat, nutritional, or allergenic problems. Although this is far beyond of the current system, exploring the recipes that surrounds the target ingredient could be a hint, for example. Recipes of expensive and fatty French would be re-written or complemented to "Fat-free French" by the technology.


究極食材ネットワーク：フィードバックによるネットワークの改善
このアルゴリズムはレシピがよい食材の組み合わせを抽出していることを前提としている．しかし，歴史的に継承されて来たレシピの中には栄養学的，地理学的制約から味を犠牲にした組み合わせが存在すると考えられる．したがって，アルゴリズムで生成される食材ネットワークは二つの食材の相性を大雑把にしか評価できない．美食指向，グローバル化により食材の制約がなくなり，このアルゴリズムを使って家庭やレストランで新たな食材の組み合わせを試す事ができる．すべての食材の組み合わせを正しく数値化するためには，食材の組み合わせを再評価した際に評価をネットワークにフィードバックする必要がある．これは単なるレストランのランキングサイトになるかも知れないし，センサーを使った方法になるかもしれない．

Ultimate Ingredient Network - Feedback Creations to the Network
I assumed that existing recipes are the result of sophistication of numerous experiments. However, some recipes may sacrificed tastiness in the sake of geographic limitations or nutritional requirements. This means, the current ingredient network is not entirely focused on the tastiness of ingredients, and not capable of evaluating the precise compatibility of ingredients. To improve the preciseness and accuracy of the system, we need to develop a system to feedback weather the output of the system was successful, and reflect it to the ingredient network. This could be a simple recipe web service, or more technical methods such as using sensors implemented in dishes.

組み合わせアルゴリズムの汎用的利用
このアルゴリズムは経験則的にためられてきた要素のセットに対しても有効である．例えば，ファッションアイテムのセットをインプットすることでクリエイティブでかつバランスのとれたファッションができる．こうした例は，インテリア（家具のセット），チーム編成（人のセット）などに有効かもしれない．

Broad Application of Combinatorial Algorithm
The system includes an combinatorial algorithm as the first implement of application of the ingredient network (Note that there are two functional parts in this system: the evaluation of compatibility part and combinatorial algorithm part), and this is applicable to most of contents that are empirically accumulated. More precisely, contents that includes sets of element. For instance, we can generate creative and balanced new fashion by swapping recipe data (set of ingredient) with fashion data (set of fashion items such as hats, clothes, rings, etc). This example may be applicable to interior (set of furniture), or teaming (set of member).

終わり
このプロジェクトはまだ公開していないので，この文章はクローズドであり，ファンドが見つかり次第公開する．また，アルゴリズムに関してパテント習得に意欲的である．

NOTE
The document, concept, algorithm and other related information appeared in this paper has not been published and confidential for now, except the program appeared in APPENDIX, and will be published as soon as being funded.

gaNezaネットワークビジュアライザ：
ビジュアライズはこのプロジェクトの本質ではないが，直感的な調査のための重要な技術である．本プロジェクトではネットワークのビジュアライゼーション及び解析にgaNezaを用いている．gaNezaはネットワークのビジュアライゼーションに力学モデルを用いている．ネットワークの力学もでるとは，ーー．しかし，ネットワークの規模が大きくなると動作が遅くなるため，MEGASUPERなどで用いられている手法を適応する必要がある．また，他のビジュアライゼーション，ネットワークアナライザを追加予定である．このソフトウェアは著者によって開発され，MITライセンスで公開している．Processing2.0 (processing.org)で動作し，JSON形式でネットワークデータを入力する事ができる．

APPENDIX
gaNeza - Light Weight and Easy Use Network Visualizer / Analyzer
Although visualization is not the goal of this project, visualization provides us intuitive understandings, insights or inspiration. I'm creating and using gaNeza network visualizer/analyzer for this project. gaNeza provides several network visualizers including Force-directed graph drawing algorithm which arranges nodes and links so that they are evenly distributed by assigning forces among the set of links and the set of nodes. Additional visualizer and analyzer are under development. This program has been written by author, published under MIT license, working on Processing2.0+ (http://processing.org).





＜＜＜＜＜＜
Related Research
Natureの論文では食材の化学物質を解析して，共有している化学物質の種類をカウントする事で国ごとの味を比較したり，二つの食材のペアリングが成功するか予測する研究が行われている．この研究では既存のレシピのサイエンスにフォーカスしており，新しいレシピの創造やシェフとのコラボレーションについては触れられていない．対して，IBMのcognitive cookingはシェフをプロジェクトに入れて，人間と人工知能がコラボレートすることで新しいレシピを作る実験を行っている．このプロジェクトについて現在調査中であり，学術論文などの詳細を知っていればぜひ教えてほしい．
＞＞＞＞＞＞

＜＜＜＜Personal Fablication
自分の想像力を使った創作行為は精神的な安定をもたらす事が精神医学の研究でわかっている．
しかしこうした行為は経済が大きくなるにつれて，マスプロダクトに囲まれるうちに，日常から失われつつある．
パーソナルファブリケーションはお仕着せのデザインに囲まれた生活から，ユーザひとりひとりをデザイナーにする生活様式である．３Dプリンタ，レーザーカッター，モデリングソフトウェアなどのプラットフォームによって，プロダクトを買いに行くだけでなく，自分たちが使うプロダクトに創意工夫をこらす事ができるようになる．
キッチンは一番アクセスのしやすい創作活動をおこなうラボであり，料理は失われつつある創作活動であるが，現在の多くの料理サイトの主な目的はレシピの共有に使われており，ユーザがレシピを創発するような仕組みは少ない．
＞＞＞＞＞


＜＜＜＜＜
こうした失敗はモチベーションの低下につながる．特に料理は食材を買って作って食べるプロセスが長いため，一度の失敗で継続的に創造力を使った料理をやめてしまう可能性が高い．既存のレシピを参照する事であるいていど味の予測ができるが，人間の能力では限界がある．
＞＞＞＞＞

＜＜＜＜＜
バランスのとれたレシピを作るためには，相性のよい食材を組み合わせることが重要である．よい食べ物の組み合わせ（food paring)方法は複数ある．食材が分布する場所の地理的距離（てろわーる）が近いモノを組み合わせる方法，化学物質の共有量が多いものを組み合わせる方法などである．化学物質の共有量とfood paringの関係については先行研究があり，食文化圏のなかでは共有している化学物質が多いほど同じレシピに登場しやすい（ペアリングしやすい）が，食文化圏を外れると共有量に限らずペアリングが行われる事がわかっている．こうした食べ物の組み合わせ評価方法は個々の食材のパラメータに着目している．しかし，風味には複数のパラメータが関連しており，微小なパラメータの変化が風味に大きく影響してしまう．風味の最大のファクターである香りの例では，バラの香りの化学物質と人間の排泄物の香りの化学物質はほとんど同じである．
＞＞＞＞＞

＜＜＜＜＜
このアルゴリズムは良い味を保証しつつクリエイティビティを兼ね備えたレシピを生成する．レシピの味のクリエイティビティと安定性はレシピを構成する食材同士の相性で決定すると仮定する．食材群から任意に選んだ食材セットのお互いの相性を数値化する事でレシピのクリエイティビティと安定性を評価する．
＞＞＞＞＞

